try:
    import mysql.connector as ms
    import PySimpleGUI as sg
    import matplotlib.pyplot as plt
except ModuleNotFoundError:
    import sys, subprocess
    subprocess.check_call([sys.executable, "-m", "pip", "install", 'PySimpleGUI'])
    subprocess.check_call([sys.executable, '-m', 'pip', 'install', 'matplotlib'])
    subprocess.check_call([sys.executable, '-m', 'pip', 'install', 'mysql-connector-python'])
    import PySimpleGUI as sg
    import matplotlib.pyplot as plt
sg.theme('BluePurple')
layout = [[sg.Text(text="Enter Mysql Login Credentials")],
          [sg.Text(text="Username"), sg.Input(default_text='root', key='username')],
          [sg.Text(text="Password"), sg.In(password_char='*', key='password')],
          [sg.Button(button_text='Login', key='login'), sg.Button(button_text='Cancel', key="Cancel")],
          [sg.Text(key='label', text='',size=(60,1))]]
window1 = sg.Window(title='MYSQL Login Page', layout=layout)
while True:
    event, value = window1.read()
    if event ==sg.WINDOW_CLOSED or event=='Cancel':
        break
    elif event == 'login':
        user = value['username']
        password = value['password']
        try:
            mycon = ms.connect(user=user, password=password, host='localhost')
            if mycon.is_connected():
                break
        except (ms.ProgrammingError, ms.OperationalError) as e1:
            window1.FindElement('label').Update("Can't connect to server, Check server status and credentials")
    else:
        pass
window1.close()
leftColumn=[[sg.Text(text="Create Users Here",pad=(10,0))],
          [sg.Text(text='Enter Name'),sg.In(default_text='ABCD',text_color='grey',key='name')],
          [sg.Text(text='Enter Phone'),sg.In(default_text='1234567890',text_color='grey',key='phone')],
          [sg.Text(text='Enter Address'),sg.In(default_text='H-1892',text_color='grey',key='address')],
          [sg.Button(button_text='Submit',key='submit')]],
RightColumn=[[sg.Text(text="Find Users Here")],
          [sg.Text(text='Search User By'),sg.InputOptionMenu(values=['Name','Address','Phone'])],
          [sg.Text(text="Enter the query"),sg.In(key='squery'),sg.Button(button_text='Search',key='search')],
          [sg.Table(key='table',values=[])]]
layout2=[leftColumn,sg.VerticalSeparator,RightColumn]
window2=sg.Window(title="COVID19 User Finder/Creator",layout=layout2)
while True:
    event,value=window2.read()
    if event==sg.WINDOW_CLOSED:
        break
    elif event=='submit':
        mycur=mycon.cursor()
        mycur.execute("show databases;")
        data = mycur.fetchall()
        if ('covid19',) in data:
            mycur.execute("use covid19;")
        else:
            mycur.execute("create database covid19;")
            mycur.execute("use covid19;")
        mycur.execute("show tables")
        data2 = mycur.fetchall()
        if [('User',),("Meetings",)] in data2:
            try:
                mycur.execute("insert into User(Name,Phone No,Address) values(%s,%s,%s)", (
                    value['name'], value['Phone'], value["Address"]))
                mycon.commit()
                mycur.execute('select * from data')
                data3 = mycur.fetchall()
            except ms.IntegrityError:
                pass
        else:
            mycur.execute(
                "create table User(UserID primary key auto_increment,Name varchar(18) not null,Phone int(10) UNIQUE not null,Address varchar(30) not null")
            mycur.execute("insert into User(Name,Phone No,Address) values(%s,%s,%s)", (
                value['name'], value['Phone'], value["Address"]))
            mycon.commit()
window2.close()
